<div class="pageContent">
    <form method="post" action="{$host_name}/goods/goodsadd" class="pageForm required-validate" enctype="multipart/form-data" onsubmit="return iframeCallback(this, dialogAjaxDone)">
        <input name="id" id="goods_id" type="hidden" value="{$vinfo.id}"/>
        <div class="pageFormContent modal-body">
            <div class="form-group row">
                <label class="col-xs-12 col-sm-2 control-label">名称：</label>
                <div class="col-xs-12 col-sm-10">
                    <input name="name" type="text" value="{$vinfo.name}" class="form-control" required/>
                </div>
            </div>

<!--            <div class="form-group row">-->
<!--                <label class="col-xs-12 col-sm-2 control-label">价格：</label>-->
<!--                <div class="col-xs-12 col-sm-10">-->
<!--                    <input name="price" type="number" value="{$vinfo.price}" class="form-control" required/>-->
<!--                </div>-->
<!--            </div>-->

            <div class="form-group row">
                <label class="col-xs-12 col-sm-2 control-label">条码：</label>
                <div class="col-xs-12 col-sm-10">
                    <input name="barcode" type="text" value="{$vinfo.barcode}" class="form-control" required/>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-xs-12 col-sm-2 control-label">
                    类型:
                </label>
                <div class="col-xs-12 col-sm-10">
                    <select name="category_id" id="goods_type" class="form-control bs-select" data-size="20" required>
                        <volist name="all_category" id="cateinfo">
                            <option value="{$cateinfo.id}" <if condition="$cateinfo.id eq $vinfo['category_id']"> selected </if> > {$cateinfo.name}</option>
                        </volist>
                    </select>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-xs-12 col-sm-2 control-label">
                    规格:
                </label>
                <div class="col-xs-12 col-sm-10">
                    <select name="specification_id" id="specification_id" class="form-control" data-size="20" required>

                    </select>
                </div>
            </div>

<!--            <div class="form-group row">-->
<!--                <label class="col-xs-12 col-sm-2 control-label">-->
<!--                    单位:-->
<!--                </label>-->
<!--                <div class="col-xs-12 col-sm-10">-->
<!--                    <select name="unit_id" id="unit_id" class="form-control" data-size="20" >-->
<!--                    </select>-->
<!--                </div>-->
<!--            </div>-->

            <div class="form-group row">
                <label class="col-xs-12 col-sm-2 control-label">
                    供应商:
                </label>
                <div class="col-xs-12 col-sm-10">
                    <select name="supplier_id" class="form-control bs-select class-filter" data-live-search="true">
                        <volist name="all_supplier" id="aspinfo">
                            <option value="{$aspinfo.id}" <if condition="$aspinfo.id eq $vinfo['supplier_id']"> selected </if> > {$aspinfo.name}</option>
                        </volist>
                    </select>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-xs-12 col-sm-2 control-label">
                    品牌:
                </label>
                <div class="col-xs-12 col-sm-10">
                    <select name="brand_id" id="goods_brand_id" class="form-control bs-select" data-size="20" required>
                        <volist name="all_brand" id="brinfo">
                            <option value="{$brinfo.id}" <if condition="$brinfo.id eq $vinfo['brand_id']"> selected </if> > {$brinfo.name}</option>
                        </volist>
                    </select>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-xs-12 col-sm-2 control-label">
                    系列:
                </label>
                <div class="col-xs-12 col-sm-10">
                    <select name="series_id" id="series_id" class="form-control" data-size="20" required>
                    </select>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-xs-12 col-sm-2 control-label">
                    关联方式:
                </label>
                <div class="col-xs-12 col-sm-10">
                    <select id="link_type" name="link_type" class="form-control bs-select">
                        <volist name=":C('GOODS_LINK_TYPE')" id="lkname">
                            <option value="{$key}" <if condition="$key eq $vinfo['link_type']"> selected </if> >{$lkname}</option>
                        </volist>
                    </select>
                </div>
            </div>
            <div class="form-group row">
                <label class="col-xs-12 col-sm-2 control-label">
                    说明：
                </label>
                <div class="col-xs-12 col-sm-10">
                    <textarea name="desc" value="{$vinfo.desc}" type="textInput" class="form-control" required>{$vinfo.desc}</textarea>
                </div>
            </div>

            <div class="form-group row" id="defaultpic">
                <label class="col-xs-12 col-sm-2 control-label">
                    商品图片：
                </label>
                <div class="col-xs-12 col-sm-10">
                    <div class="fileinput fileinput-new" data-fileinput>
                        <div class="fileinput-preview thumbnail" data-trigger="fileinput">
                            <a data-target="#modal-file" href="javascript:void(0)">
                                <if condition="($vinfo['oss_addr'] eq 'NULL') OR $vinfo['oss_addr'] eq ''">
                                    <img id="media_idimg" src="/Public/admin/assets/img/noimage.png" border="0" />
                                    <else />
                                    <img id="media_idimg" src="{$vinfo.oss_addr}" border="0" />
                                </if>
                                <span id="media_idimgname"></span>
                            </a>
                        </div>
                        <div>
                            <a class="btn btn-success btn-file" data-target="#modal-file" href="{$host_name}/resource/uploadResource?filed=media_id&rtype=2" data-browse-file>
                                选择图片
                            </a>
                            <input type="hidden" name="media_id" id="media_id" value="{$vinfo.media_id}" >
                            <a href="javascript:;" class="btn btn-danger" data-remove-file="/Public/admin/assets/img/noimage.png">删除</a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-xs-12 col-sm-2 control-label">
                    状态：
                </label>
                <div class="col-xs-12 col-sm-10">
                    <input type="hidden" name="status" value="2">
                    <input type="checkbox" value="1" class="make-switch status" name="status" data-size="small" data-on-text="开启" data-off-text="关闭" <if condition="$vinfo.status eq 1" >checked</if>>
                </div>
            </div>

        </div>
        <div class="modal-footer">
            <button class="btn btn-default close-m" type="button">取消</button>
            <button class="btn btn-primary" type="submit">保存</button>
        </div>
    </form>
</div>
<script>
    $('#goods_type').change(function() {
        var goods_id = $("#goods_id").val()
        var now_category_id = $(this).val()
        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: '{$host_name}/goods/getAjaxOtherinfo',
            data: 'goods_id='+goods_id+'&category_id='+now_category_id,
            success: function(msg) {
                var all_specification = msg.specifications;
                var all_unit = msg.units;
                if (all_specification!=null) {
                    var specification_option_str = '';
                    for (var i=0; i < all_specification.length; i++) {
                        specification_option_str+='<option value="'+all_specification[i].id+'"'+all_specification[i].is_select+'>'+all_specification[i].name+'</option>';
                    }
                    $("#specification_id").empty()
                    $("#specification_id").append(specification_option_str);
                }
                // if (all_unit!=null) {
                //     var unit_option_str = '';
                //     for (var i=0; i < all_unit.length; i++) {
                //         unit_option_str+='<option value="'+all_unit[i].id+'"'+all_unit[i].is_select+'>'+all_unit[i].name+'</option>';
                //     }
                //     $("#unit_id").empty()
                //     $("#unit_id").append(unit_option_str);
                // }
            }
        })
    })
    $('#goods_type').trigger('change');

    $('#goods_brand_id').change(function() {
        var goods_id = $("#goods_id").val()
        var now_brand_id = $(this).val()

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: '{$host_name}/goods/getAjaxOtherinfo',
            data: 'goods_id='+goods_id+'&brand_id='+now_brand_id,
            success: function(msg) {
                var all_series = msg.series;
                if (all_series!=null) {
                    var series_option_str = '';
                    for (var i=0; i < all_series.length; i++) {
                        series_option_str+='<option value="'+all_series[i].id+'"'+all_series[i].is_select+'>'+all_series[i].name+'</option>';
                    }
                    $("#series_id").empty()
                    $("#series_id").append(series_option_str);
                }
            }
        })
    })
    $("#goods_brand_id").trigger('change');


</script>